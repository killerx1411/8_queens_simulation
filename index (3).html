<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>8 Queens Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        #board {
            cursor: pointer;
            border: 4px solid #333; 
            border-radius: 10px;    
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to right, #e0eafc, #cfdef3);
            padding: 20px;
            text-align: center;
        }
        .controls {
            background-color: #ffffffcc;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: inline-block;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 16px;
            margin: 5px;
            background-color: #0077cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover { background-color: #005fa3; }
        #board-container { 
            margin: 20px auto; 
            display: flex; 
            justify-content: center;
            transition: transform 0.3s;
        }
        #board {
            cursor: pointer;
        }
        .cell { stroke: #444; stroke-width: 0.5; }
        .queen { font-size: 30px; text-anchor: middle; dominant-baseline: central; fill: #222; }
        .highlight { fill: orange !important; }
        .removing { fill: red !important; }
        input[type="range"] { width: 150px; }
        label.switch {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 20px;
        }
        .solution-info {
            background-color: #ffffffcc;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: inline-block;
            margin-top: 20px;
            max-width: 90%;
        }
        .solution-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .solution-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        .solution-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .solution-board {
            margin: 0 auto;
        }
        .enlarged {
            transform: scale(1.5);
            z-index: 10;
        }
        .solution-enlarged {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(2);
            z-index: 100;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .solution-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        #solutions-found {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 10px;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 99;
            display: none;
        }
    </style>
</head>
<body>
    <h1>8 Queens Problem Visualization</h1>
    <div class="controls">
        <button id="start">Start</button>
        <button id="pause">Pause</button>
        <button id="reset">Reset</button>
        <button id="prev">Previous Move</button>
        <button id="next">Next Move</button><br>
        <label>Speed: <input type="range" id="speed" min="50" max="1000" value="300"> <span id="speed-val">300ms</span></label>
        <label class="switch">
            <input type="checkbox" id="pauseOnSolution" checked>
            Pause on Solution
        </label>
        <div id="status">Ready to start</div>
    </div>
    <div id="board-container">
        <div id="board"></div>
    </div>
    <div class="solution-info">
        <div><strong>Current Position:</strong> <span id="current-position">[]</span></div>
        <div><strong>Current Solution:</strong> <span id="solution">None yet</span></div>
        <div id="solutions-found">
            <h3>Solutions Found: <span id="solution-count">0</span></h3>
            <div class="solution-grid" id="solutions-list"></div>
        </div>
    </div>
    <div class="overlay" id="overlay"></div>

    <script>
        const size = 8, cellSize = 50;
        const boardDiv = d3.select("#board");
        const svg = boardDiv.append("svg").attr("width", size * cellSize).attr("height", size * cellSize);
        let speed = 300, current = [], row = 0, col = 0, running = false, paused = false;
        let stepMode = false, pauseOnSolution = true, solutionFound = false;
        let history = [], historyIndex = -1, solutions = [];
        let boardEnlarged = false;

        // Initialize UI elements
        const speedSlider = document.getElementById("speed");
        speedSlider.addEventListener("input", () => {
            speed = parseInt(speedSlider.value);
            document.getElementById("speed-val").textContent = `${speed}ms`;
        });

        document.getElementById("pauseOnSolution").addEventListener("change", e => {
            pauseOnSolution = e.target.checked;
        });

        // Board enlargement toggle
        document.getElementById("board-container").addEventListener("click", () => {
            boardEnlarged = !boardEnlarged;
            document.getElementById("board-container").classList.toggle("enlarged", boardEnlarged);
        });

        function drawBoard() {
            svg.selectAll("*").remove();
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    svg.append("rect")
                        .attr("x", c * cellSize)
                        .attr("y", r * cellSize)
                        .attr("width", cellSize)
                        .attr("height", cellSize)
                        .attr("class", "cell")
                        .attr("fill", (r + c) % 2 === 0 ? "#f0d9b5" : "#b58863")
                        .attr("id", `cell-${r}-${c}`);
                }
            }
        }

        function createSolutionBoard(solution, index) {
            const solutionBoard = d3.create("svg")
                .attr("width", size * cellSize * 0.8)
                .attr("height", size * cellSize * 0.8)
                .attr("class", "solution-board");
            
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    solutionBoard.append("rect")
                        .attr("x", c * cellSize * 0.8)
                        .attr("y", r * cellSize * 0.8)
                        .attr("width", cellSize * 0.8)
                        .attr("height", cellSize * 0.8)
                        .attr("class", "cell")
                        .attr("fill", (r + c) % 2 === 0 ? "#f0d9b5" : "#b58863");
                }
            }
            
            solution.forEach((col, row) => {
                solutionBoard.append("text")
                    .attr("x", col * cellSize * 0.8 + (cellSize * 0.8) / 2)
                    .attr("y", row * cellSize * 0.8 + (cellSize * 0.8) / 2)
                    .attr("class", "queen")
                    .text("♕");
            });
            
            return solutionBoard.node();
        }

        function updatePositionInfo() {
            document.getElementById("current-position").textContent = JSON.stringify(current);
            if (current.length === size) {
                document.getElementById("solution").textContent = JSON.stringify(current);
            } else {
                document.getElementById("solution").textContent = "None yet";
            }
        }

        function updateQueens() {
            svg.selectAll(".queen").remove();
            current.forEach((c, r) => {
                svg.append("text")
                    .attr("x", c * cellSize + cellSize / 2)
                    .attr("y", r * cellSize + cellSize / 2)
                    .attr("class", "queen")
                    .text("♕");
            });
            updatePositionInfo();
        }

        function highlightCell(r, c, isBacktracking = false) {
            d3.selectAll(".cell").attr("fill", (d, i, nodes) => {
                const row = Math.floor(i / size), col = i % size;
                return (row + col) % 2 === 0 ? "#f0d9b5" : "#b58863";
            });
            if (r >= 0 && r < size && c >= 0 && c < size) {
                d3.select(`#cell-${r}-${c}`).attr("fill", isBacktracking ? "red" : "orange");
            }
        }

        function isSafe(r, c) {
            return current.every((qc, qr) =>
                qc !== c &&
                Math.abs(qc - c) !== Math.abs(qr - r)
            );
        }

        function saveHistory() {
            history.push({
                current: [...current],
                row: row,
                col: col,
                solutionFound: solutionFound
            });
            historyIndex = history.length - 1;
        }

        function addSolution(solution) {
            if (!solutions.some(s => JSON.stringify(s) === JSON.stringify(solution))) {
                solutions.push([...solution]);
                document.getElementById("solution-count").textContent = solutions.length;
                
                const solutionsList = document.getElementById("solutions-list");
                const solutionItem = document.createElement("div");
                solutionItem.className = "solution-item";
                
                const title = document.createElement("div");
                title.className = "solution-title";
                title.textContent = `Solution ${solutions.length}:`;
                solutionItem.appendChild(title);
                
                const boardContainer = document.createElement("div");
                boardContainer.appendChild(createSolutionBoard(solution, solutions.length));
                solutionItem.appendChild(boardContainer);
                
                // Add click handler for enlarging
                solutionItem.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const enlargedBoard = document.createElement("div");
                    enlargedBoard.className = "solution-enlarged";
                    
                    const enlargedTitle = document.createElement("div");
                    enlargedTitle.className = "solution-title";
                    enlargedTitle.textContent = `Solution ${solutions.length}: [${solution.join(", ")}]`;
                    enlargedBoard.appendChild(enlargedTitle);
                    
                    const board = createSolutionBoard(solution, solutions.length);
                    board.setAttribute("width", size * cellSize);
                    board.setAttribute("height", size * cellSize);
                    enlargedBoard.appendChild(board);
                    
                    const overlay = document.getElementById("overlay");
                    overlay.style.display = "block";
                    overlay.appendChild(enlargedBoard);
                    
                    overlay.addEventListener("click", () => {
                        overlay.style.display = "none";
                        overlay.innerHTML = "";
                    });
                });
                
                solutionsList.appendChild(solutionItem);
            }
        }

        async function step() {
            if (!running) return;
            
            saveHistory();
            
            if (row === size) {
                solutionFound = true;
                addSolution(current);
                document.getElementById("status").textContent = `Solution Found! (Total: ${solutions.length})`;
                updateQueens();
                
                if (pauseOnSolution) {
                    paused = true;
                    stepMode = true;
                    return;
                }
                
                // Continue to next solution
                row--; 
                col = current.pop() + 1;
                highlightCell(row, col, true);
                solutionFound = false;
                return;
            }

            if (col >= size) {
                if (--row < 0) {
                    running = false;
                    document.getElementById("status").textContent = `Done. Found ${solutions.length} solutions.`;
                    return;
                }
                col = current.pop() + 1;
                highlightCell(row, col, true);
                updateQueens();
                return;
            }

            highlightCell(row, col);
            document.getElementById("status").textContent = `Checking row ${row}, col ${col}`;

            if (isSafe(row, col)) {
                current.push(col);
                row++; col = 0;
                updateQueens();
            } else {
                col++;
            }
        }

        async function animate() {
            while (running && !paused && !stepMode) {
                await step();
                await new Promise(resolve => setTimeout(resolve, speed));
            }
        }

        function loadFromHistory(index) {
            if (index < 0 || index >= history.length) return;
            
            const state = history[index];
            current = [...state.current];
            row = state.row;
            col = state.col;
            solutionFound = state.solutionFound;
            historyIndex = index;
            
            drawBoard();
            updateQueens();
            highlightCell(row, col);
            document.getElementById("status").textContent = 
                solutionFound ? `Solution Found! (Total: ${solutions.length})` : `Checking row ${row}, col ${col}`;
        }

        document.getElementById("start").addEventListener("click", () => {
            if (!running) {
                drawBoard(); 
                current = []; row = 0; col = 0; 
                running = true; paused = false; stepMode = false; solutionFound = false;
                history = []; historyIndex = -1;
                solutions = [];
                document.getElementById("solutions-list").innerHTML = "";
                document.getElementById("solution-count").textContent = "0";
                updateQueens();
                animate();
            } else {
                // If paused on solution, just continue automatically
                paused = false; 
                stepMode = false;
                animate();
            }
        });

        document.getElementById("pause").addEventListener("click", () => {
            paused = true;
        });

        document.getElementById("reset").addEventListener("click", () => {
            running = false; paused = false; stepMode = false; solutionFound = false;
            current = []; row = 0; col = 0;
            history = []; historyIndex = -1;
            solutions = [];
            document.getElementById("solutions-list").innerHTML = "";
            document.getElementById("solution-count").textContent = "0";
            document.getElementById("status").textContent = "Reset.";
            drawBoard(); 
            updateQueens();
            updatePositionInfo();
        });

        document.getElementById("next").addEventListener("click", async () => {
            if (!running) {
                running = true;
                stepMode = true;
            }
            paused = false;
            await step();
        });

        document.getElementById("prev").addEventListener("click", () => {
            if (historyIndex > 0) {
                loadFromHistory(historyIndex - 1);
            }
        });

        // Initialize
        drawBoard();
        updatePositionInfo();
    </script>
</body>
</html>
